# 南京大学图书馆OPAC系统服务器配置指南

## 问题分析

在运行原始服务器时，遇到了以下问题：

1. **端口冲突**：多个服务尝试使用相同端口（5000、8000）
2. **依赖问题**：Flask等第三方库可能导致稳定性问题
3. **路径问题**：相对路径可能导致文件找不到
4. **跨域问题**：前端和后端分离部署导致的跨域访问限制
5. **环境限制**：在当前环境中，复杂的服务器配置可能导致服务不稳定退出

## 解决方案

创建了一个**稳定的一体化服务器** `final_server.py`，具有以下特点：

### 核心特性

1. **一体化设计**：前端和后端合并在一个服务器中，避免跨域问题
2. **减少依赖**：使用Python标准库实现HTTP服务，减少外部依赖
3. **端口配置**：使用端口8080，避免常见端口冲突
4. **简化实现**：
   - 模拟数据库功能（减少SQLite依赖）
   - 简化的搜索功能（减少网络请求依赖）
   - 基础的用户认证（不依赖JWT等复杂库）
5. **稳定性优先**：使用标准库的HTTPServer实现，提高在当前环境中的稳定性

### 支持的API

- `POST /api/register` - 用户注册
- `POST /api/login` - 用户登录
- `GET /api/user/campus` - 获取用户校区
- `GET /api/search` - 图书搜索
- `GET /api/search/history` - 获取搜索历史

## 使用方法

### 启动服务器

```bash
cd d:\easier-nju-lib
python final_server.py
```

服务器将在 `http://127.0.0.1:8080` 启动，同时提供前端和后端服务。

### 访问系统

打开浏览器，访问：`http://127.0.0.1:8080`

### 测试API功能

运行测试脚本：

```bash
python test_api.py
```

## 技术说明

### 目录结构

```
d:\easier-nju-lib\
├── frontend/          # 前端代码
├── backend/           # 原始后端代码
├── final_server.py    # 最终稳定版服务器
├── test_api.py        # API测试脚本
└── SERVER_SETUP.md    # 本指南
```

### 服务器配置

- **端口**：8080
- **前端目录**：`frontend/`
- **后端API**：`/api/*`
- **启动方式**：`python final_server.py`

### 安全说明

1. 本服务器仅用于开发环境
2. 密码使用SHA256加密存储
3. SSL证书验证已禁用（仅用于开发）

## 常见问题

### 端口被占用

如果端口8080被占用，可以修改 `final_server.py` 中的 `PORT` 常量。

### 前端文件找不到

确保 `frontend` 目录存在且包含正确的前端文件。

### 服务启动失败

检查日志输出，确保Python环境正确配置。

## 总结

这个简化的一体化服务器解决了原始服务器的稳定性问题，同时保持了核心功能的完整性。在当前环境中，它提供了更稳定的服务，适合用于开发和测试。
