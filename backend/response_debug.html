



<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <title>检索列表</title>
    <link type="text/css" rel="stylesheet" href="/weixin/css/weui.min.css"/>
    <link type="text/css" rel="stylesheet" href="/weixin/css/searchList.css">
</head>
<body>
<div class="weui-panel weui-panel_access">
    <div class="weui-panel__hd" id="searchVal">检索词：</div>
    <div class="weui-panel__bd">
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=59889&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5447-4183-5&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5447-4183-5</p>
                    <p class="weui-media-box__desc">出版信息：译林出版社  2013</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=5898465&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5193-0019-7&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5193-0019-7</p>
                    <p class="weui-media-box__desc">出版信息：群言出版社  2016</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=5862973&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5534-1525-3&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英)乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5534-1525-3</p>
                    <p class="weui-media-box__desc">出版信息：吉林出版集团有限责任公司  2013</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=5692728&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-80256-121-2&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔</p>
                    <p class="weui-media-box__desc">ISBN：978-7-80256-121-2</p>
                    <p class="weui-media-box__desc">出版信息：群言出版社  2010</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=476215&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5640-7801-0&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5640-7801-0</p>
                    <p class="weui-media-box__desc">出版信息：北京理工大学出版社  2013</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=424063&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5302-1029-1&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5302-1029-1</p>
                    <p class="weui-media-box__desc">出版信息：北京十月文艺出版社  2010</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=41166&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5354-4569-8&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5354-4569-8</p>
                    <p class="weui-media-box__desc">出版信息：长江文艺出版社  2010</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=361751&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5339-3461-3&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5339-3461-3</p>
                    <p class="weui-media-box__desc">出版信息：浙江文艺出版社  2012</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=320195&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=978-7-5399-5368-7&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：978-7-5399-5368-7</p>
                    <p class="weui-media-box__desc">出版信息：江苏文艺出版社  2013</p>
                </div>
            </a>
        
            <a href="/weixin/searchResultDetail/getDetail?recordId=2953531&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    
                    
                        <img class="weui-media-box__thumb" src="/weixin/book/preview?title=1984&isbn=10261.659&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src='/weixin/image/default.png';">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">1984</h4>
                    <p class="weui-media-box__desc">责任者：(英) 乔治·奥威尔著</p>
                    <p class="weui-media-box__desc">ISBN：10261.659</p>
                    <p class="weui-media-box__desc">出版信息：花城出版社  1985</p>
                </div>
            </a>
        
    </div>
    <div class="loading">正在加载</div>
    <div class="error">加载失败</div>
    
        
            
            
        
    
</div>

<script src="/weixin/js/zepto.min.js"></script>
<script>
    $('.loading').hide();
    $('.error').hide();
    function addItem(array) {
        $.each(array, function (index, item) {
            var html = [
                '<a href="/weixin/searchResultDetail/getDetail?recordId='+item.recordId+'&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1" class="weui-media-box weui-media-box_appmsg">',
                '<div class="weui-media-box__hd">',
                '<img class="weui-media-box__thumb" src="/weixin/book/preview?title='+(item.title || '')+'&isbn='+(item.isbn || '')+'&mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I" alt="" onError="this.onerror=null; this.src=\'/weixin/image/default.png\';" >',
                
                '</div>',
                '<div class="weui-media-box__bd">',
                '<h4 class="weui-media-box__title">'+(item.title || '') +'</h4>',
                '<p class="weui-media-box__desc">责任者：'+ (item.author || '') +'</p>',
                '<p class="weui-media-box__desc">ISBN：'+ (item.isbn || '') +'</p>',
                '<p class="weui-media-box__desc">出版信息：'+ (item.publisher || '') + '  ' + (item.publishYear || '') +'</p>',
                '</div>',
                '</a>'
            ];
            $('.weui-panel__bd').append(html.join(''));
        });
    }

    $(function(){
        $('#searchVal').text('检索词：' + "1984");
        var page = 1;
        var flag = true; // flag 用于防止滚动中（内容还未加载完毕）加载多次
        var total = 6436;
        if(total <= page * 10){
            flag = false;
            $('.weui-panel__bd').append('<div class="bottom">到底了~</div>');
        }
        var mess = JSON.stringify(new unifySearch("1984", "keyWord", 10, page + 1));
        $('#moreBtn').on('click', function () {
            $.ajax({
                url: "/weixin/unify/unifySearchAdd?mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1",
                type: "post",
                
                data:mess,
                contentType: "application/json",
                success: function(data){
                    var vo = eval(data);
                    var list = vo.searchResult;
                    page = page + 1;
                    mess = JSON.stringify(new unifySearch("1984", "keyWord", 10, page + 1));
                    addItem(list);
                }
            });
        });

        // jquery实现
        $(window).bind("scroll", function (event) {
            //滚动条到网页头部的 高度，兼容ie,ff,chrome
            var top = document.documentElement.scrollTop + document.body.scrollTop;
            //网页的高度
            var textheight = $(document).height();
            // 网页高度-top-当前窗口高度
            if (textheight - top - $(window).height() <= 100) {
                if (flag) {
                    // 触发后
                    flag = false;
                    $('.loading').show();
                    // 加载更多
                    ajaxSearch();

                }

            }

        });
        function ajaxSearch() {
            $.ajax({
                url: "/weixin/unify/unifySearchAdd?mappingPath=njulib&groupCode=200027&openid=oeL7DjraEzAnkWJpPrebGqI6B55I&pubId=1",
                type: "post",
                
                data:mess,
                contentType: "application/json",
                success: function(data){
                    var vo = eval(data);
                    var list = vo.searchResult||[];
                    var numFound = vo.numFound || 0;
                    page = page + 1;
                    mess = JSON.stringify(new unifySearch("1984", "keyWord", 10, page + 1));
                    $('.loading').hide();
                    addItem(list);
                    console.log(numFound);

                    if (numFound <= page * 10) {
                        flag = false;
                        $('.weui-panel__bd').append('<div class="bottom">到底了~</div>');
                    } else {
                        flag = true;
                    }

                },
                error:function () {
                    $('.loading').hide();
                    $('.error').show();
                }
            });
        }
    });
    function unifySearch(searchFieldContent,searchField,rows,page){
        this.searchFieldContent=searchFieldContent;
        this.searchField=searchField;
        this.rows=rows;
        this.page=page;
    }

</script>
</body>
</html>
